# Bullion Tracker Web - Environment Configuration
# Copy this file to .env and fill in values for your environment
#
# SECURITY: Never commit .env files with real values to git
# Use secrets management (Vercel, 1Password) for production

# =============================================================================
# Database
# =============================================================================
DATABASE_URL="postgresql://postgres:postgres@localhost:5432/bullion_tracker"

# =============================================================================
# NextAuth.js
# =============================================================================
# Generate with: openssl rand -base64 32
NEXTAUTH_SECRET="your-secret-key-here"
NEXTAUTH_URL="http://localhost:3000"

# =============================================================================
# Google OAuth (Optional)
# =============================================================================
# Get from: https://console.cloud.google.com/apis/credentials
GOOGLE_CLIENT_ID="your-google-client-id"
GOOGLE_CLIENT_SECRET="your-google-client-secret"

# =============================================================================
# Metal Price API
# =============================================================================
# Get from: https://metalpriceapi.com
NEXT_PUBLIC_METAL_PRICE_API_KEY="your-api-key-here"

# =============================================================================
# Rate Limiting (Optional)
# =============================================================================
# Uses in-memory fallback without these (not persistent across restarts)
# Get from: https://console.upstash.com
UPSTASH_REDIS_REST_URL=
UPSTASH_REDIS_REST_TOKEN=

# =============================================================================
# Cloudinary Image Storage (Recommended)
# =============================================================================
# Without Cloudinary, images are stored as base64 in the database (not recommended)
# Get your credentials from: https://cloudinary.com/console
#
# Setup steps:
# 1. Create free Cloudinary account
# 2. Go to Settings > Upload > Upload presets
# 3. Click "Add upload preset"
# 4. Set "Signing Mode" to "Unsigned"
# 5. Set folder to "bullion-tracker" (optional)
# 6. Copy the preset name below
#
NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME=
NEXT_PUBLIC_CLOUDINARY_UPLOAD_PRESET=

# =============================================================================
# Admin/Development (Optional)
# =============================================================================
# For protected seed endpoint in development
ADMIN_SEED_KEY=

# =============================================================================
# Production Deployment Notes
# =============================================================================
#
# Vercel: Set environment variables in Project Settings > Environment Variables
# Railway: Set in Variables tab of your service
# Render: Set in Environment section of your web service
#
# Required for production:
# - DATABASE_URL (production PostgreSQL - Supabase, Railway, Neon)
# - NEXTAUTH_SECRET (generate new: openssl rand -base64 32)
# - NEXTAUTH_URL (your production URL, e.g., https://bullion.example.com)
# - NEXT_PUBLIC_METAL_PRICE_API_KEY
#
# Recommended for production:
# - UPSTASH_REDIS_REST_URL (for rate limiting persistence)
# - UPSTASH_REDIS_REST_TOKEN
# - NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME (for image storage)
# - NEXT_PUBLIC_CLOUDINARY_UPLOAD_PRESET
#
# Optional for production:
# - GOOGLE_CLIENT_ID/SECRET (if using Google OAuth)
# - ADMIN_SEED_KEY (only if seed endpoint needed)
#
# Security checklist before deploying:
# [ ] NEXTAUTH_SECRET is unique and secure (not default)
# [ ] DATABASE_URL uses SSL connection (sslmode=require)
# [ ] All API keys are production keys (not test keys)
# [ ] Rate limiting is enabled (Upstash configured)
# [ ] Cloudinary configured (avoids database bloat from base64 images)
#
# =============================================================================
# Migration: Existing Base64 Images to Cloudinary
# =============================================================================
#
# If you have existing images stored as base64 in the database, you can
# migrate them to Cloudinary using the provided script.
#
# Prerequisites:
# 1. Configure Cloudinary (see above)
# 2. Ensure DATABASE_URL is set
#
# Steps:
# 1. Preview what will be migrated (dry run):
#    npx tsx scripts/migrate-images-to-cloudinary.ts --dry-run
#
# 2. Run the migration:
#    npx tsx scripts/migrate-images-to-cloudinary.ts
#
# Options:
#   --dry-run    Preview without making changes
#   --batch=N    Process N images per batch (default: 10)
#   --delay=N    Wait N ms between batches (default: 1000)
#   --help       Show all options
#
# Notes:
# - Migration is idempotent (safe to run multiple times)
# - Already-migrated images (URLs starting with http) are skipped
# - Failed uploads can be retried by running the script again
# - New uploads automatically go to Cloudinary if configured

# =============================================================================
# SECURITY AUDIT STATUS
# =============================================================================
#
# Last security review: 2026-01-10 (Phase 13: Credential Cleanup)
#
# Security measures implemented:
# - [x] .env files gitignored (never committed to repository)
# - [x] JWT secrets require explicit configuration (fail-fast, Phase 3)
# - [x] Password requirements: 8+ chars, uppercase, lowercase, number (Phase 3)
# - [x] Seed endpoint protected (dev-only + optional ADMIN_SEED_KEY, Phase 3)
# - [x] Rate limiting on auth endpoints (Phase 3)
# - [x] No hardcoded credentials in source code (Phase 13)
#
# Pre-deployment verification:
# [ ] Run: git ls-files | grep -E "\.env$" (must return empty)
# [ ] Verify NEXTAUTH_SECRET is unique (not "your-secret-key-here")
# [ ] Verify DATABASE_URL uses SSL (sslmode=require)
# [ ] Verify all API keys are production keys
# [ ] Configure Upstash for persistent rate limiting
# [ ] Configure Cloudinary for image storage
#
# Reference: .planning/phases/03-security-hardening/ for security implementation details
