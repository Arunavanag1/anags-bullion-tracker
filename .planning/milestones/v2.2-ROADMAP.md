# Milestone v2.2: Cert Number Autofill

**Status:** SHIPPED 2026-01-18
**Phases:** 49-51
**Total Plans:** 3

## Overview

Add autofill functionality for coins using PCGS/NGC certification numbers, enabling quick coin lookup and form population on both web and mobile platforms.

## Phases

### Phase 49: Cert Lookup API Integration - COMPLETE
**Goal**: Integrate PCGS Cert Verification and NGC Verify APIs for certification number lookup
**Depends on**: Phase 48
**Plans**: 1 plan

Plans:
- [x] 49-01: API endpoint, TypeScript PCGS client, mobile integration, form autofill

**Details:**
- Created TypeScript PCGS API client (`src/lib/pcgs-api.ts`) with OAuth2 authentication, token caching, retry logic
- Built `/api/coins/cert-lookup` endpoint supporting PCGS API integration and NGC fallback
- Added `lookupCertNumber()` function to mobile API layer with error handling
- Enhanced NumismaticForm with debounced cert lookup, auto-populate fields
- NGC requests return manual lookup URL (no public API available)

### Phase 50: Autofill Form Component - COMPLETE
**Goal**: Create cert number input with debounced lookup, auto-populate form fields from cert data
**Depends on**: Phase 49
**Plans**: 1 plan

Plans:
- [x] 50-01: useCertLookup hook, AddItemModal integration, NGC fallback

**Details:**
- Created `useCertLookup` React hook using TanStack Query mutation for API calls
- Integrated cert autofill into web AddItemModal with debounced lookup (800ms)
- Auto-populates grade, metal type, price guide value, and triggers coin search
- NGC requests show yellow alert with "Open NGC Lookup" link

### Phase 51: Mobile Cert Scanner - COMPLETE
**Goal**: Add camera-based barcode/QR scanning for cert number extraction on mobile
**Depends on**: Phase 50
**Plans**: 1 plan

Plans:
- [x] 51-01: CertScanner component, NumismaticForm integration, PCGS barcode + NGC QR parsing

**Details:**
- Created full-screen barcode scanner modal with expo-camera
- Multi-format barcode support (ITF14, QR, Code128, Codabar, Code39)
- PCGS 22-digit ITF barcode parsing (positions 14-22 = cert number)
- NGC QR code URL pattern parsing
- Auto-detection of grading service based on barcode type

---

## Milestone Summary

**Key Decisions:**
- TypeScript over Python for PCGS API client (simpler deployment)
- 800ms debounce for cert lookup to avoid excessive API calls
- Mutation over Query for cert lookup (on-demand, not cached)
- Multi-format barcode support for PCGS/NGC label variations
- Full-screen modal for scanner UX

**Issues Resolved:**
- Worklets version mismatch (added react-native-worklets peer dependency)
- Historical prices stale (updated through Jan 18)

**Issues Deferred:**
- PCGS API requires account credentials (user configuration)

**Technical Debt Incurred:**
- None

---

_For current project status, see .planning/ROADMAP.md_
