# Milestone v2.1: Coin Database Expansion

**Status:** âœ… SHIPPED 2026-01-18
**Phases:** 43-48
**Total Plans:** 6

## Overview

Expand coin reference database from ~100 to ~8,000 coins covering popular collectible series, using hybrid PCGS API + web scraping approach. Built complete infrastructure for automated price updates and data quality validation.

## Phases

### Phase 43: PCGS API Integration

**Goal**: Implement PCGS Public API client with OAuth, rate limiting (1,000/day), and daily quota tracking
**Depends on**: Phase 42
**Plans**: 1/1

Plans:
- [x] 43-01: API client with OAuth2, quota tracking, CLI test script

**Details:**
- Created `PCGSApiClient` class with OAuth2 password grant authentication
- Implemented `QuotaTracker` for daily API call limits with JSON persistence
- Built CLI script for testing API endpoints and checking quota status
- Added automatic token refresh and retry logic with exponential backoff

### Phase 44: Series Priority Mapping

**Goal**: Define target series (~5,830 coins): 20th century types, commemoratives, key early US; create scraping roadmap with priorities
**Depends on**: Phase 43
**Plans**: 1/1

Plans:
- [x] 44-01: Research categories, expand COIN_SERIES (67 series), create SCRAPING-ROADMAP.md

**Details:**
- Expanded COIN_SERIES config to 67 series
- Created priority tiers (P0-P3) for phased population
- Documented series_research.json with category metadata

### Phase 45: Bulk Scraper Enhancement

**Goal**: Update existing Python scraper for new series, add NGC number cross-reference, fix any broken HTML selectors
**Depends on**: Phase 44
**Plans**: 1/1

Plans:
- [x] 45-01: Updated selectors, progress tracking, error handling, CLI

**Details:**
- Enhanced PCGS scraper with selector fallbacks
- Progress tracking with SQLite resume capability
- Circuit breaker for error resilience
- CLI for scraping operations (run_scraper.py)

### Phase 46: Data Population Pipeline

**Goal**: Run scraper for all priority series, implement incremental update tracking, monitor progress with logging
**Depends on**: Phase 45
**Plans**: 1/1

Plans:
- [x] 46-01: Population runner, validation module, P0 run (blocked by PCGS)

**Details:**
- Population orchestration script with monitoring
- Data validation module (CoinValidator, ValidationReport)
- Dual logging (console + file) pattern
- P0 run blocked by PCGS anti-bot measures

### Phase 47: Price Refresh Automation

**Goal**: Set up cron job for daily price updates via PCGS API
**Depends on**: Phase 46
**Plans**: 1/1

Plans:
- [x] 47-01: Price refresh script, Vercel cron, logging/reporting

**Details:**
- Python price refresh script with quota management
- Vercel Cron endpoint for scheduled sync
- Daily budget calculation based on API quota
- Price history tracking for trends

### Phase 48: Search & Validation

**Goal**: Optimize full-text search (tsvector), data quality validation, missing coin detection, admin reports
**Depends on**: Phase 47
**Plans**: 1/1

Plans:
- [x] 48-01: Full-text search with tsvector/GIN, validate_data.py CLI

**Details:**
- PostgreSQL tsvector with GIN index for fast search
- ts_rank for relevance-ordered results
- validate_data.py CLI for data quality reports
- Weight priorities: A=fullName, B=series, C=denomination, D=year

---

## Milestone Summary

**Key Decisions:**
- PCGS API over web scraping (web scraping blocked by anti-bot)
- 1,000 calls/day quota with daily budget calculation
- 67 series across 4 priority tiers (P0-P3)
- tsvector for search instead of unused searchTokens field
- Circuit breaker pattern for resilience

**Issues Resolved:**
- Circular import in API module (lazy imports)
- Python 3.9 type hint compatibility
- Schema column name mismatches in validate_data.py

**Issues Deferred:**
- Actual coin population blocked by PCGS 403 errors
- NGC cross-reference not implemented (no need with API approach)

**Technical Debt Incurred:**
- Only 100 coins populated (infrastructure ready for 8,000+)
- Greysheet scraping not yet used for secondary pricing

---

_For current project status, see .planning/ROADMAP.md_
