# Phase 61 Plan 01: Manual Metal Input UI

## Context

Phase 60 added automatic metal content detection through cert lookup. This phase adds manual input UI for RAW coins and custom coins that don't have automatic metal detection via coinReference or US coinage rules.

## Prior Phase Outputs

- **Phase 58**: Metal content schema fields (metalPurity, metalWeightOz, preciousMetalOz)
- **Phase 59**: US coinage rules engine (`detectUSCoinMetalContent`)
- **Phase 60**: Cert lookup metal autofill integration

## Goal

Add manual metal content input fields (purity percentage, weight in oz) to web and mobile forms for RAW/custom coins, with API support for accepting these values.

## Key Files

**API (modify):**
- `bullion-tracker/src/app/api/collection/route.ts` - Accept manual metal content fields

**Web (modify):**
- `bullion-tracker/src/components/collection/AddItemModal.tsx` - Add purity/weight inputs to RAW coin section

**Mobile (modify):**
- `bullion-tracker-mobile/src/components/addItem/NumismaticForm.tsx` - Add purity/weight inputs

**Utilities (use):**
- `bullion-tracker/src/lib/metal-content.ts` - `isValidPurity`, `isValidWeight`, `calculatePreciousMetalOz`

## Design Decisions

1. **Purity input as percentage (0-100)** - More intuitive than decimal (0.0-1.0); convert on submit
2. **Weight input in troy oz** - Standard numismatic unit
3. **Optional fields** - User can leave blank if unknown
4. **Auto-calculate preciousMetalOz** - API calculates from purity Ã— weight
5. **Show only for RAW/custom coins** - Graded coins get metal content from coinReference or cert lookup

## Tasks

### Task 1: Add manual metal content to API

**File:** `bullion-tracker/src/app/api/collection/route.ts`

**Changes:**
1. Accept `metalPurity` and `metalWeightOz` in request body for NUMISMATIC items
2. When no automatic detection (no coinReferenceId or rules match), use manual values
3. Calculate `preciousMetalOz` using `calculatePreciousMetalOz` utility
4. Validate purity is 0-100 (percentage input), weight is positive

**Test:** Create numismatic item with manual metal content via API

### Task 2: Add metal content inputs to web RAW coin form

**File:** `bullion-tracker/src/components/collection/AddItemModal.tsx`

**Changes:**
1. Add state: `metalPurity` (string), `metalWeightOz` (string) - empty by default
2. Add collapsible "Metal Content (Optional)" section after Metal Type in RAW coin form
3. Add two inputs:
   - Purity: number input, placeholder "e.g., 90 for 90% silver", suffix "%"
   - Weight: number input, placeholder "e.g., 0.7234", suffix "oz"
4. Include in submit data: convert purity from percentage (divide by 100)
5. Style to match existing form patterns

**Test:** Manually verify form displays and submits correctly

### Task 3: Add metal content inputs to mobile NumismaticForm

**File:** `bullion-tracker-mobile/src/components/addItem/NumismaticForm.tsx`

**Changes:**
1. Add state: `metalPurity` (string), `metalWeightOz` (string)
2. Add to `NumismaticFormData` interface
3. Add collapsible section for metal content when RAW
4. Add two Input components with labels
5. Pass values through to submit handler

**Test:** Manually verify mobile form displays and submits correctly

## Verification

1. Create RAW coin with manual metal content on web - values saved correctly
2. Create RAW coin with manual metal content on mobile - values saved correctly
3. Create RAW coin without metal content - still works (backward compatible)
4. Graded coins ignore manual input (use coinReference/cert lookup instead)

## Files Changed

- `bullion-tracker/src/app/api/collection/route.ts`
- `bullion-tracker/src/components/collection/AddItemModal.tsx`
- `bullion-tracker-mobile/src/components/addItem/NumismaticForm.tsx`

## Estimated Scope

3 tasks, ~100 lines changed total
