---
phase: 17-mobile-code-audit
plan: 01
type: execute
---

<objective>
Audit the bullion-tracker-mobile codebase to document architecture, identify patterns/anti-patterns, and create foundational documentation for the refactoring phases.

Purpose: Establish clear understanding of current state before making changes in Phases 18-20.
Output: MOBILE-ARCHITECTURE.md documenting structure, patterns, concerns, and refactoring priorities.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./17-01-SUMMARY.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/codebase/ARCHITECTURE.md
@.planning/codebase/CONCERNS.md
@.planning/codebase/STRUCTURE.md

**Mobile app source files:**
@bullion-tracker-mobile/App.tsx
@bullion-tracker-mobile/src/contexts/AuthContext.tsx
@bullion-tracker-mobile/src/lib/api.ts
@bullion-tracker-mobile/src/screens/DashboardScreen.tsx
@bullion-tracker-mobile/src/screens/CollectionScreen.tsx

**Known mobile concerns (from CONCERNS.md):**
- Hardcoded API URL in api.ts
- AuthContext fragility (token refresh, race conditions)
- Large coin sync without pagination
- No test coverage

**Prior decisions affecting mobile:**
- Phase 4: Use expo-constants for mobile config (app.json extra, not .env)
- Phase 13: Removed test credentials UI
</context>

<tasks>

<task type="auto">
  <name>Task 1: Audit mobile app structure and identify patterns</name>
  <files>bullion-tracker-mobile/src/**/*</files>
  <action>
    Systematically analyze the mobile codebase:

    1. **File organization audit:**
       - List all directories and their purposes
       - Identify naming conventions used
       - Flag inconsistencies or misplacements

    2. **Component inventory:**
       - Catalog all screens (6 expected)
       - Catalog all components with line counts
       - Identify shared vs. screen-specific components

    3. **Pattern identification:**
       - State management approach (contexts, local state)
       - Data fetching patterns (api.ts usage)
       - Navigation structure (App.tsx routing)
       - Styling approach (NativeWind/Tailwind)

    4. **Anti-pattern detection:**
       - Large files (>300 lines) that need splitting
       - Prop drilling instances
       - Duplicated code across screens
       - Missing TypeScript types
       - Hardcoded values that should be configurable

    Create a structured analysis as intermediate notes (will feed into Task 2).
  </action>
  <verify>Console output shows complete inventory of files, patterns identified, and anti-patterns flagged</verify>
  <done>Full audit completed covering: file structure, components, patterns, anti-patterns</done>
</task>

<task type="auto">
  <name>Task 2: Create MOBILE-ARCHITECTURE.md documentation</name>
  <files>bullion-tracker-mobile/MOBILE-ARCHITECTURE.md</files>
  <action>
    Create comprehensive architecture documentation based on Task 1 audit:

    **Document structure:**
    ```markdown
    # Mobile App Architecture

    ## Overview
    [Brief description of app purpose and tech stack]

    ## Directory Structure
    [Annotated tree with purposes]

    ## Screens
    [Table: Screen name, purpose, key components, line count]

    ## Components
    ### Shared Components
    [Reusable across screens]
    ### Screen-Specific Components
    [Used in single screen only]

    ## State Management
    [Current approach: AuthContext, local state, etc.]
    [Data flow diagram or description]

    ## API Layer
    [How api.ts works, authentication, error handling]

    ## Patterns in Use
    [Good patterns to preserve]

    ## Anti-Patterns Found
    [Problems to address with specific file:line references]

    ## Refactoring Priorities
    [Ordered list for Phases 18-20]

    ## Dependencies
    [Key packages and their purposes]
    ```

    Be specific with file:line references for anti-patterns. Include line counts to help prioritize refactoring targets.
  </action>
  <verify>cat bullion-tracker-mobile/MOBILE-ARCHITECTURE.md shows complete documentation with all sections filled</verify>
  <done>MOBILE-ARCHITECTURE.md created with: overview, structure, screens, components, state management, API layer, patterns, anti-patterns with line references, refactoring priorities</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] All mobile source files audited (screens, components, lib, contexts)
- [ ] MOBILE-ARCHITECTURE.md exists in bullion-tracker-mobile/
- [ ] Document includes anti-patterns with specific file:line references
- [ ] Document includes refactoring priorities for Phases 18-20
- [ ] No unaddressed files or directories
</verification>

<success_criteria>
- All tasks completed
- MOBILE-ARCHITECTURE.md provides actionable guidance for Phases 18-20
- Anti-patterns are specific enough to act on (file:line references)
- Refactoring priorities are ordered by impact/effort
</success_criteria>

<output>
After completion, create `.planning/phases/17-mobile-code-audit/17-01-SUMMARY.md`:

---
phase: 17-mobile-code-audit
plan: 01
subsystem: mobile
provides: [mobile-architecture-doc, refactoring-priorities]
affects: [18, 19, 20]
tags: [audit, documentation, mobile]
key-files:
  - bullion-tracker-mobile/MOBILE-ARCHITECTURE.md
---

# Phase 17 Plan 01: Mobile Code Audit Summary

**[Substantive one-liner about what was documented/discovered]**

## Accomplishments
- [Key findings from audit]

## Files Created/Modified
- `bullion-tracker-mobile/MOBILE-ARCHITECTURE.md` - Architecture documentation

## Anti-Patterns Found
- [Summary of issues with counts]

## Refactoring Priorities for Phases 18-20
- [Ordered list]

## Next Step
Phase 17 complete, ready for Phase 18 (State Management Refactor)
</output>
