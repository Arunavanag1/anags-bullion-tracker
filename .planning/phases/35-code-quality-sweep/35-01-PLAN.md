---
phase: 35-code-quality-sweep
plan: 01
type: execute
---

<objective>
Replace all `any` types with proper TypeScript types across API routes and lib files.

Purpose: Eliminate type safety gaps that could hide bugs and improve IDE support.
Output: Zero `@typescript-eslint/no-explicit-any` errors.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./35-01-SUMMARY.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/34-performance-review/34-02-SUMMARY.md

**Files with `any` types to fix:**
@bullion-tracker/src/app/api/auth/mobile/refresh/route.ts
@bullion-tracker/src/app/api/coins/price-guide/route.ts
@bullion-tracker/src/app/api/collection/[id]/history/route.ts
@bullion-tracker/src/app/api/collection/[id]/route.ts
@bullion-tracker/src/app/api/collection/route.ts
@bullion-tracker/src/app/api/collection/sync-prices/route.ts
@bullion-tracker/src/app/api/prices/seed/route.ts
@bullion-tracker/src/auth.ts
@bullion-tracker/src/lib/utils.ts
@bullion-tracker/src/app/page.tsx

**Tech stack:** Next.js 16.1, TypeScript 5.x, Prisma 7.2
**Established patterns:** Use Prisma-generated types, use existing types from src/types/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix `any` types in API routes</name>
  <files>
    bullion-tracker/src/app/api/auth/mobile/refresh/route.ts,
    bullion-tracker/src/app/api/coins/price-guide/route.ts,
    bullion-tracker/src/app/api/collection/[id]/history/route.ts,
    bullion-tracker/src/app/api/collection/[id]/route.ts,
    bullion-tracker/src/app/api/collection/route.ts,
    bullion-tracker/src/app/api/collection/sync-prices/route.ts,
    bullion-tracker/src/app/api/prices/seed/route.ts
  </files>
  <action>
Replace each `any` type with the appropriate specific type:

1. For catch block errors: Use `unknown` and narrow with type guards, or use `Error` type
2. For Prisma query results: Use Prisma-generated types or infer from the query
3. For request body parsing: Define interface for expected shape or use `Record<string, unknown>`
4. For dynamic objects: Use `Record<string, unknown>` or define specific interface

Common patterns:
- `catch (error: any)` → `catch (error: unknown)` then use `error instanceof Error`
- `const data: any = {}` → `const data: Record<string, unknown> = {}` or specific interface
- Prisma where clauses: Use Prisma's generated `XxxWhereInput` types

Do NOT use `// @ts-ignore` or `// eslint-disable` - fix the actual types.
  </action>
  <verify>npx eslint src/app/api/ --max-warnings=50 2>&1 | grep -c "no-explicit-any" returns 0</verify>
  <done>All API route files have zero `any` types</done>
</task>

<task type="auto">
  <name>Task 2: Fix `any` types in auth and lib files</name>
  <files>
    bullion-tracker/src/auth.ts,
    bullion-tracker/src/lib/utils.ts,
    bullion-tracker/src/app/page.tsx
  </files>
  <action>
Replace remaining `any` types:

1. src/auth.ts - NextAuth callbacks often need specific session/user types
2. src/lib/utils.ts - Utility functions should have proper generic types
3. src/app/page.tsx - Component props and event handlers need proper types

For NextAuth:
- Use `Session` and `User` types from next-auth
- Define extended types if adding custom properties

For utilities:
- Use generics where appropriate: `function util<T>(input: T): T`
- Use union types for known variations

For React components:
- Use proper event types: `React.MouseEvent<HTMLButtonElement>`
- Use component prop interfaces
  </action>
  <verify>npx eslint src/auth.ts src/lib/utils.ts src/app/page.tsx --max-warnings=50 2>&1 | grep -c "no-explicit-any" returns 0</verify>
  <done>All auth, lib, and page files have zero `any` types</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npx eslint src/ 2>&1 | grep -c "no-explicit-any"` returns 0
- [ ] `npm run build` succeeds without errors
- [ ] `npm test` passes all 76 tests
</verification>

<success_criteria>

- All `@typescript-eslint/no-explicit-any` errors eliminated
- No new TypeScript errors introduced
- Build passes
- Tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/35-code-quality-sweep/35-01-SUMMARY.md`
</output>
