---
phase: 19-component-refactor
plan: 01
type: execute
---

<objective>
Split AddItemScreen into step components and extract shared TabBar to reduce duplication and improve maintainability.

Purpose: Complete component refactor portion of v1.5 Mobile Refactor milestone, reducing large file sizes and eliminating remaining duplication.
Output: AddItemScreen split into 4 step components (~200 lines each), shared TabBar component, cleaner screen files.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./19-01-SUMMARY.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Phase 17-18 (direct dependencies):**
@.planning/phases/17-mobile-code-audit/17-01-SUMMARY.md
@.planning/phases/18-state-management-refactor/18-01-SUMMARY.md
@bullion-tracker-mobile/MOBILE-ARCHITECTURE.md

**Source files to modify:**
@bullion-tracker-mobile/src/screens/AddItemScreen.tsx
@bullion-tracker-mobile/src/screens/DashboardScreen.tsx
@bullion-tracker-mobile/src/screens/CollectionScreen.tsx
@bullion-tracker-mobile/src/screens/CollageScreen.tsx

**Existing patterns to follow:**
@bullion-tracker-mobile/src/components/ui/Button.tsx
@bullion-tracker-mobile/src/components/ui/TabButton.tsx
@bullion-tracker-mobile/src/components/ui/PricePill.tsx

**Constraining decisions:**
- Phase 18: Shared UI components follow Button.tsx pattern (Props interface, StyleSheet styles)
- Phase 18: SpotPricesContext placed inside AuthProvider (screens already use useSpotPrices)

**Tech stack available:**
- React Native 0.81.5 with Expo SDK 54
- TypeScript 5.9
- NativeWind for styling (mix with StyleSheet)
- Colors from lib/colors.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Split AddItemScreen into step components</name>
  <files>
    bullion-tracker-mobile/src/screens/AddItemScreen.tsx,
    bullion-tracker-mobile/src/components/addItem/CategoryStep.tsx (new),
    bullion-tracker-mobile/src/components/addItem/GradingStep.tsx (new),
    bullion-tracker-mobile/src/components/addItem/BullionForm.tsx (new),
    bullion-tracker-mobile/src/components/addItem/NumismaticForm.tsx (new),
    bullion-tracker-mobile/src/components/addItem/index.ts (new)
  </files>
  <action>
    1. Create `src/components/addItem/` directory

    2. Create `CategoryStep.tsx` (~80 lines):
       - Extract `renderCategorySelection()` from AddItemScreen.tsx (lines 189-230)
       - Props: `{ onSelect: (category: ItemCategory) => void }`
       - Include category card styles
       - Follow Button.tsx pattern for typing

    3. Create `GradingStep.tsx` (~70 lines):
       - Extract `renderGradingSelection()` from AddItemScreen.tsx (lines 232-279)
       - Props: `{ onSelect: (service: GradingService) => void }`
       - Include grading selection styles

    4. Create `BullionForm.tsx` (~150 lines):
       - Extract `renderBullionForm()` from AddItemScreen.tsx (lines 281-373)
       - Props: `{ onSubmit: (data: BullionFormData) => Promise<void>; loading: boolean }`
       - Move metal button styles, form styles
       - Define BullionFormData interface

    5. Create `NumismaticForm.tsx` (~200 lines):
       - Combine `renderRawNumismaticForm()` and `renderGradedNumismaticForm()` into single component
       - Props: `{ gradingService: GradingService; onSubmit: (data: NumismaticFormData) => Promise<void>; loading: boolean }`
       - Move numismatic-specific styles
       - Define NumismaticFormData interface

    6. Create `index.ts` barrel export:
       ```typescript
       export { CategoryStep } from './CategoryStep';
       export { GradingStep } from './GradingStep';
       export { BullionForm } from './BullionForm';
       export { NumismaticForm } from './NumismaticForm';
       ```

    7. Update `AddItemScreen.tsx` (~200 lines):
       - Import from './components/addItem'
       - Keep step state management, navigation, header, step indicator
       - Remove inline render functions
       - Remove styles that moved to step components
       - Pass callbacks to step components

    Do NOT change any form logic or validation - exact extraction only. Preserve all existing behavior.
  </action>
  <verify>
    - npx tsc --noEmit passes
    - AddItemScreen.tsx is now ~200 lines (down from 776)
    - All 4 step component files exist in src/components/addItem/
    - App starts without errors: npx expo start
    - Add item flow works: navigate to add item, select category, complete form
  </verify>
  <done>
    - AddItemScreen.tsx reduced from 776 to ~200 lines
    - CategoryStep.tsx, GradingStep.tsx, BullionForm.tsx, NumismaticForm.tsx exist
    - All step components properly typed with Props interfaces
    - Add item flow functions identically to before
  </done>
</task>

<task type="auto">
  <name>Task 2: Create shared TabBar component</name>
  <files>
    bullion-tracker-mobile/src/components/ui/TabBar.tsx (new),
    bullion-tracker-mobile/src/screens/DashboardScreen.tsx,
    bullion-tracker-mobile/src/screens/CollectionScreen.tsx,
    bullion-tracker-mobile/src/screens/CollageScreen.tsx
  </files>
  <action>
    1. Create `src/components/ui/TabBar.tsx` (~60 lines):
       - Props: `{ activeTab: 'dashboard' | 'collection' | 'collage'; onTabPress: (tab: string) => void; collectionBadge?: number }`
       - Use TabButton component (already shared)
       - Include tabBar styles (currently duplicated in 3 screens at identical positions)
       - StyleSheet with tabBar container styles

    2. Update DashboardScreen.tsx:
       - Import TabBar from '../components/ui/TabBar'
       - Replace inline `<View style={styles.tabBar}>...3 TabButtons...</View>` (lines 350-369)
       - Remove tabBar style from StyleSheet (line 653-665)
       - Pass navigation callbacks

    3. Update CollectionScreen.tsx:
       - Import TabBar from '../components/ui/TabBar'
       - Replace inline tabBar View + TabButtons (lines 259-278)
       - Remove tabBar style from StyleSheet (line 561-573)

    4. Update CollageScreen.tsx:
       - Import TabBar from '../components/ui/TabBar'
       - Replace inline tabBar View + TabButtons (lines 130-149)
       - Remove tabBar style from StyleSheet (line 237-249)

    This eliminates ~40 lines of duplicated tabBar code across 3 screens.
  </action>
  <verify>
    - npx tsc --noEmit passes
    - TabBar.tsx exists in src/components/ui/
    - No inline tabBar View/styles remain in screen files
    - App starts and bottom navigation works on all 3 screens
    - Active tab highlighting works correctly
    - Collection badge shows correct count
  </verify>
  <done>
    - TabBar.tsx exists as shared component
    - All 3 screens use shared TabBar
    - ~40 lines of duplication removed
    - Navigation behavior unchanged
  </done>
</task>

<task type="auto">
  <name>Task 3: Add JSDoc comments to new components</name>
  <files>
    bullion-tracker-mobile/src/components/addItem/CategoryStep.tsx,
    bullion-tracker-mobile/src/components/addItem/GradingStep.tsx,
    bullion-tracker-mobile/src/components/addItem/BullionForm.tsx,
    bullion-tracker-mobile/src/components/addItem/NumismaticForm.tsx,
    bullion-tracker-mobile/src/components/ui/TabBar.tsx
  </files>
  <action>
    Add JSDoc comments to each new component following this pattern:

    ```typescript
    /**
     * CategoryStep - First step of add item flow
     *
     * Displays BULLION vs NUMISMATIC category selection cards.
     * BULLION goes directly to details, NUMISMATIC goes to grading step.
     *
     * @example
     * <CategoryStep onSelect={(cat) => setCategory(cat)} />
     */
    ```

    For each component add:
    - Brief description of purpose
    - Key behavior notes
    - Usage example

    Keep comments concise (3-5 lines). Do NOT add comments to unchanged files.
  </action>
  <verify>
    - Each new component file has JSDoc at top
    - Comments are accurate and concise
    - npx tsc --noEmit still passes
  </verify>
  <done>
    - All 5 new component files have JSDoc documentation
    - Documentation describes purpose and usage
  </done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] npx tsc --noEmit passes in bullion-tracker-mobile/
- [ ] App starts without errors
- [ ] Add item flow works end-to-end (bullion and numismatic)
- [ ] Bottom navigation works on Dashboard, Collection, Collage screens
- [ ] AddItemScreen.tsx is ~200 lines (down from 776)
- [ ] 5 new component files exist with JSDoc comments
</verification>

<success_criteria>
- All 3 tasks completed
- AddItemScreen split from 776 â†’ ~200 lines + 4 step components
- TabBar extracted and shared across 3 screens
- New components have JSDoc documentation
- No visual or behavioral regressions
- ~100+ lines of code removed through deduplication
</success_criteria>

<output>
After completion, create `.planning/phases/19-component-refactor/19-01-SUMMARY.md`:

---
phase: 19-component-refactor
plan: 01
subsystem: mobile
provides: [additem-step-components, shared-tabbar, component-docs]
affects: [20-api-data-layer-cleanup]
tags: [refactor, components, mobile, documentation]
key-files:
  - bullion-tracker-mobile/src/components/addItem/CategoryStep.tsx
  - bullion-tracker-mobile/src/components/addItem/GradingStep.tsx
  - bullion-tracker-mobile/src/components/addItem/BullionForm.tsx
  - bullion-tracker-mobile/src/components/addItem/NumismaticForm.tsx
  - bullion-tracker-mobile/src/components/ui/TabBar.tsx
---

# Phase 19 Plan 01: Component Refactor Summary

**[Substantive one-liner about what was refactored]**

## Accomplishments
- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified
- `bullion-tracker-mobile/src/components/addItem/` - Step components for add item flow
- `bullion-tracker-mobile/src/components/ui/TabBar.tsx` - Shared bottom navigation
- [Modified screens]

## Decisions Made
[Any decisions about implementation approach]

## Issues Encountered
[Problems and resolutions, or "None"]

## Next Step
Phase 19 complete, ready for Phase 20 (API & Data Layer Cleanup)
</output>
