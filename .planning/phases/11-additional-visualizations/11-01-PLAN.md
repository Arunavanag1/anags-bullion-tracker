---
phase: 11-additional-visualizations
plan: 01
type: execute
---

<objective>
Add pie and bar charts for portfolio allocation and gain/loss visualization.

Purpose: Provide users with additional ways to understand their portfolio composition and performance at a glance.
Output: New AllocationChart and GainLossChart components integrated into the dashboard.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./11-01-SUMMARY.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/codebase/STACK.md
@.planning/codebase/CONVENTIONS.md

**Key files:**
@bullion-tracker/src/components/charts/PortfolioChart.tsx
@bullion-tracker/src/app/page.tsx (dashboard)
@bullion-tracker/src/hooks/useCollection.ts
@bullion-tracker/src/lib/calculations.ts

**Tech available:**
- Recharts 3.6.0 (PieChart, BarChart, Cell, ResponsiveContainer already exported)
- Tailwind CSS 4
- TanStack Query

**Data available from useCollection:**
- items with metal (gold/silver/platinum), weightOz, category (BULLION/NUMISMATIC)
- Calculation functions: calculateCurrentMeltValue, calculateCurrentBookValue
- From useSpotPrices: current spot prices per metal

**Patterns from PortfolioChart:**
- Card wrapper component
- Responsive container
- Filter buttons for views
- Tooltip styling
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create AllocationPieChart component</name>
  <files>bullion-tracker/src/components/charts/AllocationPieChart.tsx</files>
  <action>
Create a new AllocationPieChart component that shows portfolio allocation:

1. Component structure:
   - Accept collection items and spot prices as props
   - Use Card wrapper for consistency
   - Include toggle for "By Metal" vs "By Category" view

2. By Metal view:
   - Calculate total value per metal (gold, silver, platinum)
   - Use metal-themed colors: Gold #C9A227, Silver #9CA3AF, Platinum #6B7280
   - Show percentage and dollar amount in tooltip

3. By Category view:
   - Calculate total value for BULLION vs NUMISMATIC
   - Use distinct colors: Bullion #C9A227, Numismatic #4F46E5
   - Show percentage and dollar amount in tooltip

4. UI elements:
   - Title: "Portfolio Allocation"
   - Toggle buttons styled like PortfolioChart filters
   - Legend showing each segment with color, label, percentage
   - Center label showing total portfolio value

Use Recharts PieChart, Pie, Cell, Tooltip, ResponsiveContainer.
  </action>
  <verify>
- Component renders pie chart with correct metal/category breakdown
- Toggle switches between views
- Tooltips show correct values
- Colors match design system
- npm run build passes
  </verify>
  <done>AllocationPieChart renders correctly with both views, build passes</done>
</task>

<task type="auto">
  <name>Task 2: Create GainLossBarChart component</name>
  <files>bullion-tracker/src/components/charts/GainLossBarChart.tsx</files>
  <action>
Create a GainLossBarChart component showing gain/loss by metal:

1. Component structure:
   - Accept collection items and spot prices as props
   - Use Card wrapper
   - Calculate gain/loss: current melt value - book value (cost basis)

2. Data calculation:
   - Group items by metal
   - For each metal: sum(meltValue) - sum(bookValue)
   - Positive values = gains (green), negative = losses (red)

3. Chart configuration:
   - Horizontal bar chart for better label readability
   - Bar colors: positive #22C55E (green), negative #EF4444 (red)
   - Y-axis: metal names (Gold, Silver, Platinum)
   - X-axis: dollar values with proper formatting
   - Show percentage change in tooltip

4. Summary row below chart:
   - Total portfolio gain/loss
   - Overall percentage change

Use Recharts BarChart, Bar, XAxis, YAxis, Tooltip, Cell, ResponsiveContainer.
  </action>
  <verify>
- Component renders bar chart with correct gain/loss per metal
- Positive bars are green, negative are red
- Tooltip shows dollar and percentage
- Summary shows correct total
- npm run build passes
  </verify>
  <done>GainLossBarChart renders with correct calculations and colors, build passes</done>
</task>

<task type="auto">
  <name>Task 3: Integrate charts into dashboard</name>
  <files>bullion-tracker/src/app/page.tsx, bullion-tracker/src/components/charts/index.ts</files>
  <action>
Integrate the new charts into the dashboard:

1. Create barrel export file:
   - Create bullion-tracker/src/components/charts/index.ts
   - Export PortfolioChart, AllocationPieChart, GainLossBarChart

2. Update dashboard layout:
   - Import new chart components
   - Add a "Charts" section below the existing PortfolioChart
   - Use 2-column grid on desktop: AllocationPieChart | GainLossBarChart
   - Stack on mobile (single column)

3. Layout structure:
   ```
   <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
     <AllocationPieChart collection={collection} spotPrices={spotPrices} />
     <GainLossBarChart collection={collection} spotPrices={spotPrices} />
   </div>
   ```

4. Pass required data:
   - collection from useCollection hook
   - spotPrices from useSpotPrices hook
   - Handle loading/empty states gracefully
  </action>
  <verify>
- Both charts appear on dashboard
- Responsive layout works (2 cols desktop, 1 col mobile)
- Charts receive correct data
- Loading states handled
- npm run build passes
  </verify>
  <done>New charts integrated into dashboard with responsive layout, build passes</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] AllocationPieChart shows correct allocation by metal and category
- [ ] GainLossBarChart shows correct gain/loss per metal
- [ ] Both charts integrated into dashboard
- [ ] Responsive layout works on mobile and desktop
- [ ] No TypeScript errors
- [ ] `npm run build` succeeds
</verification>

<success_criteria>

- All tasks completed
- Two new chart components created
- Charts correctly calculate and display data
- Dashboard layout updated with new charts
- Build passes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/11-additional-visualizations/11-01-SUMMARY.md`
</output>
