---
phase: 10-chart-axis-refinements
plan: 01
type: execute
---

<objective>
Polish Y-axis scale controls and add X-axis date range options to the portfolio chart.

Purpose: Give users more control over how they view their portfolio data, enabling custom date ranges and refined axis formatting.
Output: Enhanced PortfolioChart with date range picker and improved tick formatting.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./10-01-SUMMARY.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/codebase/STACK.md
@.planning/codebase/CONVENTIONS.md

**Key files:**
@bullion-tracker/src/components/charts/PortfolioChart.tsx
@bullion-tracker/src/hooks/useCollection.ts

**Tech available:**
- Recharts 3.6.0 (already in use)
- Tailwind CSS 4
- TanStack Query for data fetching

**Current state:**
- Y-axis scale controls exist: Auto, From $0, Custom (with min/max inputs)
- Time range selector exists: 24H, 1W, 1M, 1Y, 5Y
- Category filter exists: All, Bullion, Numismatic
- Data comes from usePortfolioHistory hook with days parameter

**Phase goal from roadmap:**
- Refine Y-axis scale controls (auto/fromZero/custom) - DONE
- Add X-axis date range picker - NEW
- Improve tick formatting and intervals - NEW
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add custom date range picker for X-axis</name>
  <files>bullion-tracker/src/components/charts/PortfolioChart.tsx, bullion-tracker/src/hooks/useCollection.ts</files>
  <action>
Add a "Custom" option to the time range selector that shows two date inputs (start date, end date).

1. Update TIME_RANGES to include a 'custom' option with label "Custom"
2. Add state for customStartDate and customEndDate (as Date strings YYYY-MM-DD)
3. Show date inputs when timeRange === 'custom' (similar to custom scale inputs)
4. Calculate days difference from custom dates for the API call
5. Update usePortfolioHistory hook to accept either days OR startDate/endDate params
6. Update API route to handle startDate/endDate query params as alternative to days

Style date inputs to match the existing custom scale inputs (w-32 px-2 py-1.5 text-sm border border-border rounded-md).
  </action>
  <verify>
- Select "Custom" from time range shows date inputs
- Selecting date range fetches data for that range
- Default dates: last 30 days when custom selected
- npm run build passes
  </verify>
  <done>Custom date range picker works, API accepts date range params, build passes</done>
</task>

<task type="auto">
  <name>Task 2: Improve tick formatting and intervals</name>
  <files>bullion-tracker/src/components/charts/PortfolioChart.tsx</files>
  <action>
Improve axis tick formatting based on data range:

1. Y-axis tick formatting (formatYAxisValue):
   - For values under $100: show full value with cents ($85.50)
   - For values $100-$1000: show with comma ($850)
   - For values $1K-$1M: show as K with 1 decimal ($85.5K)
   - For values $1M+: show as M with 1 decimal ($1.5M)

2. X-axis tick formatting:
   - For 24H: Show hour (12 PM, 3 PM)
   - For 1W: Show day name (Mon, Tue)
   - For 1M: Show date (Jan 5, Jan 10)
   - For 1Y: Show month (Jan, Feb)
   - For 5Y: Show month + year (Jan '22)
   - For custom: Intelligently choose based on range

3. Add tickCount/interval optimization:
   - Use Recharts interval="preserveStartEnd" for cleaner ticks
   - Limit to ~6-8 ticks on X-axis regardless of data points

Update the XAxis component to use a dynamic tickFormatter based on timeRange.
  </action>
  <verify>
- Y-axis shows appropriate formatting for different value ranges
- X-axis labels are readable and appropriate for time range
- No overlapping tick labels
- npm run build passes
  </verify>
  <done>Tick formatting adapts to data range, labels readable, build passes</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] Custom date range selection works end-to-end
- [ ] Y-axis formatting adapts to value magnitude
- [ ] X-axis formatting adapts to time range
- [ ] No TypeScript errors
- [ ] `npm run build` succeeds
</verification>

<success_criteria>

- All tasks completed
- Custom date picker functional
- Tick formatting improved for all time ranges
- Build passes without errors
- Chart remains responsive and readable
</success_criteria>

<output>
After completion, create `.planning/phases/10-chart-axis-refinements/10-01-SUMMARY.md`
</output>
