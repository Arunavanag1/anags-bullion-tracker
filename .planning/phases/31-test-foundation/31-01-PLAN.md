---
phase: 31-test-foundation
plan: 01
type: execute
---

<objective>
Set up Vitest testing framework for the bullion-tracker Next.js application.

Purpose: Establish the testing infrastructure that all subsequent test plans will use.
Output: Working Vitest setup with TypeScript support, configured for Next.js, with a passing smoke test.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@bullion-tracker/package.json
@bullion-tracker/tsconfig.json

**Tech Stack:**
- Next.js 16.1 with App Router
- TypeScript 5
- React 19

**Goal:** Set up Vitest (not Jest) for testing pure functions in lib/. Vitest has better TypeScript and ESM support than Jest.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Vitest and dependencies</name>
  <files>bullion-tracker/package.json</files>
  <action>Install Vitest and required dependencies:

  ```bash
  cd bullion-tracker && npm install -D vitest @vitest/coverage-v8
  ```

  Add test scripts to package.json:
  - "test": "vitest run"
  - "test:watch": "vitest"
  - "test:coverage": "vitest run --coverage"

  Do NOT install @testing-library/react yet - this plan focuses on unit testing pure functions only.
  </action>
  <verify>npm ls vitest shows vitest installed, package.json has test scripts</verify>
  <done>Vitest installed, test scripts added to package.json</done>
</task>

<task type="auto">
  <name>Task 2: Configure Vitest for Next.js + TypeScript</name>
  <files>bullion-tracker/vitest.config.ts, bullion-tracker/src/lib/__tests__/smoke.test.ts</files>
  <action>Create vitest.config.ts at bullion-tracker root:

  ```typescript
  import { defineConfig } from 'vitest/config'
  import path from 'path'

  export default defineConfig({
    test: {
      globals: true,
      environment: 'node',
      include: ['src/**/*.test.ts', 'src/**/*.spec.ts'],
      exclude: ['node_modules', '.next'],
    },
    resolve: {
      alias: {
        '@': path.resolve(__dirname, './src'),
      },
    },
  })
  ```

  Create a smoke test at src/lib/__tests__/smoke.test.ts:

  ```typescript
  import { describe, it, expect } from 'vitest'

  describe('Vitest setup', () => {
    it('should run a basic test', () => {
      expect(1 + 1).toBe(2)
    })

    it('should handle async tests', async () => {
      const result = await Promise.resolve('hello')
      expect(result).toBe('hello')
    })
  })
  ```

  Note: Use 'node' environment since we're testing pure functions, not React components.
  </action>
  <verify>cd bullion-tracker && npm test -- runs and shows 2 passing tests</verify>
  <done>vitest.config.ts created, smoke test passes, path alias @ works</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cd bullion-tracker && npm test` runs successfully
- [ ] Smoke test shows 2 passing tests
- [ ] No TypeScript errors in vitest.config.ts
- [ ] Path alias @/ resolves correctly
</verification>

<success_criteria>
- Vitest installed and configured
- Test scripts work: npm test, npm run test:watch, npm run test:coverage
- Smoke test passes
- Ready for TDD plans (31-02, 31-03)
</success_criteria>

<output>
After completion, create `.planning/phases/31-test-foundation/31-01-SUMMARY.md`
</output>
