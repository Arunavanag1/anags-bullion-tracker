---
phase: 31-test-foundation
plan: 03
type: tdd
---

<objective>
TDD for password validation and collection summary functions.

Purpose: Ensure security-critical password validation and summary aggregation work correctly.
Output: Test coverage for validatePassword and calculateCollectionSummary functions.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/references/tdd.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@bullion-tracker/src/app/api/auth/signup/route.ts
@bullion-tracker/src/lib/calculations.ts

**Password Requirements (from signup route):**
- Minimum 8 characters
- At least one uppercase letter
- At least one lowercase letter
- At least one number

**Collection Summary:**
- Aggregates all items by metal
- Sums melt value, book value, cost basis
- Returns totals for gold, silver, platinum ounces
</context>

<feature>
  <name>Validation and Summary Functions</name>
  <files>bullion-tracker/src/lib/__tests__/validation.test.ts, bullion-tracker/src/lib/validation.ts, bullion-tracker/src/lib/__tests__/calculations.test.ts</files>
  <behavior>
    validatePassword:
    - "Password1" → { valid: true }
    - "short1A" → { valid: false, reason: "at least 8 characters" }
    - "password1" → { valid: false, reason: "uppercase letter" }
    - "PASSWORD1" → { valid: false, reason: "lowercase letter" }
    - "PasswordA" → { valid: false, reason: "number" }
    - "" → { valid: false }

    calculateCollectionSummary:
    - Empty array → all zeros
    - Single gold item: 1oz gold at $2000 → goldOz=1, totalMeltValue=2000
    - Mixed metals: 1oz gold + 10oz silver → goldOz=1, silverOz=10
    - Multiple items: sums correctly
    - Different valuation types: melt vs book calculated correctly
  </behavior>
  <implementation>
    1. Extract validatePassword from signup route into lib/validation.ts (for testability)
    2. Write tests for validatePassword
    3. Add tests for calculateCollectionSummary to existing calculations.test.ts
  </implementation>
</feature>

<verification>
cd bullion-tracker && npm test
All tests pass including validation and summary tests
</verification>

<success_criteria>
- validatePassword extracted to lib/validation.ts
- Password validation tests pass
- Collection summary tests pass
- All edge cases covered
- Phase 31 complete
</success_criteria>

<output>
After completion, create `.planning/phases/31-test-foundation/31-03-SUMMARY.md` with:
- RED: Tests written
- GREEN: Implementation verified/fixed
- REFACTOR: validatePassword extraction
- Commits: List of commits
- Phase completion status
</output>
