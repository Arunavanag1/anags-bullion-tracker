---
phase: 37-victory-native-setup
plan: 01
type: execute
---

<objective>
Set up Victory Native charting foundation with Skia dependency and reusable theme/wrapper components.

Purpose: Establish the charting infrastructure that all subsequent chart phases (38-42) will build upon.
Output: Working Victory Native setup with theme constants, ChartContainer component, and verified test chart.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Relevant source files:**
@bullion-tracker-mobile/package.json
@bullion-tracker-mobile/babel.config.js
@bullion-tracker-mobile/src/lib/colors.ts
@bullion-tracker-mobile/src/screens/DashboardScreen.tsx
@bullion-tracker-mobile/src/components/AllocationDonutChart.tsx

**Discovery findings:**
- Victory Native v41.20.2 already installed
- react-native-reanimated already configured in babel.config.js
- react-native-gesture-handler already installed
- MISSING: @shopify/react-native-skia (critical peer dependency)
- Need chart theme to match existing Colors design system

**Victory Native XL usage patterns (from docs):**
- Line charts: `<CartesianChart data={DATA} xKey="x" yKeys={["y"]}>{({ points }) => <Line points={points.y} />}</CartesianChart>`
- Pie/Donut: `<PolarChart data={DATA} labelKey="label" valueKey="value" colorKey="color"><Pie.Chart innerRadius={50} /></PolarChart>`
- Bar charts: `<CartesianChart>{({ points, chartBounds }) => <Bar points={points.y} chartBounds={chartBounds} />}</CartesianChart>`
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Skia peer dependency</name>
  <files>bullion-tracker-mobile/package.json</files>
  <action>
Install the missing @shopify/react-native-skia dependency required by Victory Native v41+.

Run: `cd bullion-tracker-mobile && npx expo install @shopify/react-native-skia`

This is a critical peer dependency for Victory Native XL's high-performance rendering. The library will fail to render charts without it.

Do NOT use npm install directly - use npx expo install for proper Expo SDK compatibility.
  </action>
  <verify>grep "@shopify/react-native-skia" bullion-tracker-mobile/package.json shows the dependency installed</verify>
  <done>@shopify/react-native-skia appears in package.json dependencies</done>
</task>

<task type="auto">
  <name>Task 2: Create chart theme constants</name>
  <files>bullion-tracker-mobile/src/lib/chartTheme.ts</files>
  <action>
Create a chart theme file that defines Victory Native styling consistent with the app's Colors design system.

Include:
1. Chart colors object mapping to Colors.gold, Colors.silver, Colors.platinum, Colors.positive, Colors.negative
2. Default axis styling (font size, colors matching textSecondary)
3. Default animation config (timing-based, 300ms duration)
4. Chart padding/margin constants
5. Font family matching app (use Platform.OS check for iOS Menlo / Android monospace)

Example structure:
```typescript
import { Platform } from 'react-native';
import { Colors } from './colors';

export const ChartTheme = {
  colors: {
    gold: Colors.gold,
    silver: Colors.silver,
    platinum: Colors.platinum,
    positive: Colors.positive,
    negative: Colors.negative,
    line: Colors.accentTeal,
    grid: Colors.border,
    axis: Colors.textSecondary,
  },
  axis: {
    fontSize: 11,
    fontFamily: Platform.OS === 'ios' ? 'Menlo' : 'monospace',
    color: Colors.textSecondary,
  },
  animation: {
    type: 'timing' as const,
    duration: 300,
  },
  layout: {
    padding: { left: 40, right: 16, top: 16, bottom: 24 },
  },
};
```
  </action>
  <verify>File exists and exports ChartTheme object with colors, axis, animation, and layout properties</verify>
  <done>chartTheme.ts exports ChartTheme with all required properties</done>
</task>

<task type="auto">
  <name>Task 3: Create ChartContainer wrapper component</name>
  <files>bullion-tracker-mobile/src/components/charts/ChartContainer.tsx</files>
  <action>
Create a reusable ChartContainer component that wraps Victory Native charts with consistent styling.

Features:
1. Accepts children (the actual chart)
2. Configurable height prop (default 200)
3. Card-style background matching app design (Colors.bgCard, borderRadius: 16)
4. Title prop for chart header
5. Loading state support
6. Error boundary for chart rendering failures

Include a simple test rendering to verify Victory Native works - render a basic line chart with hardcoded sample data to prove the Skia integration works.

Example structure:
```typescript
import React from 'react';
import { View, Text, StyleSheet, ActivityIndicator } from 'react-native';
import { Colors } from '../../lib/colors';

interface ChartContainerProps {
  title?: string;
  height?: number;
  loading?: boolean;
  children: React.ReactNode;
}

export function ChartContainer({ title, height = 200, loading, children }: ChartContainerProps) {
  return (
    <View style={[styles.container, { height: height + (title ? 40 : 0) }]}>
      {title && <Text style={styles.title}>{title}</Text>}
      {loading ? (
        <ActivityIndicator color={Colors.accentTeal} />
      ) : (
        <View style={{ height }}>{children}</View>
      )}
    </View>
  );
}
```

Also create an index.ts barrel export at bullion-tracker-mobile/src/components/charts/index.ts.
  </action>
  <verify>File exists with ChartContainer component exported, and index.ts re-exports it</verify>
  <done>ChartContainer.tsx and index.ts exist with proper exports</done>
</task>

<task type="auto">
  <name>Task 4: Create test chart component to verify setup</name>
  <files>bullion-tracker-mobile/src/components/charts/TestChart.tsx</files>
  <action>
Create a simple test chart component that renders a Victory Native line chart with hardcoded data.

Purpose: Verify Victory Native + Skia integration works before building production charts.

Use this test data:
```typescript
const TEST_DATA = [
  { x: 1, y: 100 },
  { x: 2, y: 150 },
  { x: 3, y: 125 },
  { x: 4, y: 200 },
  { x: 5, y: 175 },
];
```

Render a simple line chart:
```typescript
import React from 'react';
import { CartesianChart, Line } from 'victory-native';
import { ChartContainer } from './ChartContainer';
import { ChartTheme } from '../../lib/chartTheme';

const TEST_DATA = [
  { x: 1, y: 100 },
  { x: 2, y: 150 },
  { x: 3, y: 125 },
  { x: 4, y: 200 },
  { x: 5, y: 175 },
];

export function TestChart() {
  return (
    <ChartContainer title="Victory Native Test" height={200}>
      <CartesianChart data={TEST_DATA} xKey="x" yKeys={["y"]}>
        {({ points }) => (
          <Line
            points={points.y}
            color={ChartTheme.colors.line}
            strokeWidth={2}
            animate={ChartTheme.animation}
          />
        )}
      </CartesianChart>
    </ChartContainer>
  );
}
```

Export from index.ts as well.

Do NOT add to DashboardScreen yet - this is just for verification purposes.
  </action>
  <verify>TestChart.tsx exists and is exported from index.ts</verify>
  <done>TestChart component created and exported</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Victory Native setup with Skia, chart theme, ChartContainer, and TestChart components</what-built>
  <how-to-verify>
    1. Run: cd bullion-tracker-mobile && npx expo start
    2. Open app on device/simulator
    3. Temporarily add TestChart to DashboardScreen by adding at the end of ScrollView:
       - Import: import { TestChart } from '../components/charts';
       - Add component: <TestChart />
    4. Verify the test line chart renders (should show a simple line going up and down)
    5. Check console for any Skia-related errors
    6. Remove TestChart import and usage from DashboardScreen after verification
  </how-to-verify>
  <resume-signal>Type "approved" if chart renders correctly, or describe any rendering issues</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] @shopify/react-native-skia in package.json
- [ ] chartTheme.ts exports ChartTheme with colors, axis, animation, layout
- [ ] ChartContainer.tsx provides reusable wrapper
- [ ] TestChart.tsx renders Victory Native line chart
- [ ] Manual verification: chart renders in app without errors
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Victory Native renders charts successfully (visual verification)
- No Skia/Reanimated runtime errors
- Chart theme matches app design system colors
</success_criteria>

<output>
After completion, create `.planning/phases/37-victory-native-setup/37-01-SUMMARY.md`:

# Phase 37 Plan 01: Victory Native Setup Summary

**[Substantive one-liner about what shipped]**

## Accomplishments

- Installed @shopify/react-native-skia peer dependency
- Created chart theme matching app design system
- Created ChartContainer reusable wrapper
- Verified Victory Native renders correctly

## Files Created/Modified

- `bullion-tracker-mobile/package.json` - Added Skia dependency
- `bullion-tracker-mobile/src/lib/chartTheme.ts` - Chart theme constants
- `bullion-tracker-mobile/src/components/charts/ChartContainer.tsx` - Wrapper component
- `bullion-tracker-mobile/src/components/charts/TestChart.tsx` - Verification component
- `bullion-tracker-mobile/src/components/charts/index.ts` - Barrel exports

## Decisions Made

[Document any decisions]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Phase Readiness

Ready for Phase 38 (Portfolio Line Chart) - Victory Native infrastructure established
</output>
